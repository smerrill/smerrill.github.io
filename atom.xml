<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Grenade Sandwich]]></title>
  <link href="http://smerrill.github.io/atom.xml" rel="self"/>
  <link href="http://smerrill.github.io/"/>
  <updated>2014-05-27T09:21:44-04:00</updated>
  <id>http://smerrill.github.io/</id>
  <author>
    <name><![CDATA[Steven W. Merrill]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Title]]></title>
    <link href="http://smerrill.github.io/blog/2020/01/01/template/"/>
    <updated>2020-01-01T00:00:00-05:00</updated>
    <id>http://smerrill.github.io/blog/2020/01/01/template</id>
    <content type="html"><![CDATA[<p>Teaser</p>

<p>Teaser</p>

<!--more-->


<p>Body</p>

<p>Body</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Combining tasks with Grunt]]></title>
    <link href="http://smerrill.github.io/blog/2014/05/26/combining-tasks-with-grunt/"/>
    <updated>2014-05-26T00:00:00-04:00</updated>
    <id>http://smerrill.github.io/blog/2014/05/26/combining-tasks-with-grunt</id>
    <content type="html"><![CDATA[<p>I was recently asked to help out with a few build steps for a Drupal project using <a href="http://gruntjs.com/">Grunt</a> as its build system. The project&rsquo;s <code>Gruntfile.js</code> has a <code>drush:make</code> task that utilizes <a href="https://github.com/nickpack/grunt-drush">the grunt-drush package</a> to run Drush make. This task in included in a file under the tasks directory in the main repository.</p>

<h6>tasks/drush.js</h6>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">grunt</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="cm">/**</span>
</span><span class='line'><span class="cm">   * Define &quot;drush&quot; tasks.</span>
</span><span class='line'><span class="cm">   *</span>
</span><span class='line'><span class="cm">   * grunt drush:make</span>
</span><span class='line'><span class="cm">   *   Builds the Drush make file to the build/html directory.</span>
</span><span class='line'><span class="cm">   */</span>
</span><span class='line'>  <span class="nx">grunt</span><span class="p">.</span><span class="nx">loadNpmTasks</span><span class="p">(</span><span class="s1">&#39;grunt-drush&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">grunt</span><span class="p">.</span><span class="nx">config</span><span class="p">(</span><span class="s1">&#39;drush&#39;</span><span class="p">,</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">make</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">args</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;make&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;%= config.srcPaths.make %&gt;&#39;</span><span class="p">],</span>
</span><span class='line'>      <span class="nx">dest</span><span class="o">:</span> <span class="s1">&#39;&lt;%= config.buildPaths.html %&gt;&#39;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'><span class="p">};</span>
</span></code></pre></td></tr></table></div></figure>


<p>You can see that the task contains a few instances of <em>variable interpolation</em>, such as <code>&lt;%= config.srcPaths.make %&gt;</code>. By convention, the values of these variables go in a file called <code>Gruntconfig.json</code> file and are set using the <code>grunt.initConfig</code> method. In addition, the configuration for the <strong>default</strong> task lives in a file called <code>Gruntfile.js</code>. I have put trimmed examples of each below.</p>

<h6>Gruntfile.js</h6>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">grunt</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// Initialize global configuration variables.</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">config</span> <span class="o">=</span> <span class="nx">grunt</span><span class="p">.</span><span class="nx">file</span><span class="p">.</span><span class="nx">readJSON</span><span class="p">(</span><span class="s1">&#39;Gruntconfig.json&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">grunt</span><span class="p">.</span><span class="nx">initConfig</span><span class="p">({</span>
</span><span class='line'>    <span class="nx">config</span><span class="o">:</span> <span class="nx">config</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// Load all included tasks.</span>
</span><span class='line'>  <span class="nx">grunt</span><span class="p">.</span><span class="nx">loadTasks</span><span class="p">(</span><span class="nx">__dirname</span> <span class="o">+</span> <span class="s1">&#39;/tasks&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// Define the default task to fully build and configure the project.</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">tasksDefault</span> <span class="o">=</span> <span class="p">[</span>
</span><span class='line'>    <span class="s1">&#39;clean:default&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="s1">&#39;mkdir:init&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="s1">&#39;drush:make&#39;</span><span class="p">,</span>
</span><span class='line'>  <span class="p">];</span>
</span><span class='line'>  <span class="nx">grunt</span><span class="p">.</span><span class="nx">registerTask</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="nx">tasksDefault</span><span class="p">);</span>
</span><span class='line'><span class="p">};</span>
</span></code></pre></td></tr></table></div></figure>


<h6>Gruntconfig.json</h6>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="s2">&quot;srcPaths&quot;</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>    <span class="s2">&quot;make&quot;</span><span class="o">:</span> <span class="s2">&quot;src/mti_cms.make&quot;</span>
</span><span class='line'>  <span class="p">},</span>
</span><span class='line'>  <span class="s2">&quot;buildPaths&quot;</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>    <span class="s2">&quot;build&quot;</span><span class="o">:</span> <span class="s2">&quot;build&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="s2">&quot;html&quot;</span><span class="o">:</span> <span class="s2">&quot;build/html&quot;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>As you can see, the project&rsquo;s <code>Gruntfile.js</code> also has a <code>clean:default</code> task to remove the built site and a <code>mkdir:init</code> task to make the build/html directory, and the three tasks are combined with <code>grunt.registerTask</code> to make the <strong>default</strong> task which will be run when you invoke <code>grunt</code> with no arguments.</p>

<h2>A small change</h2>

<p>In Phase2&rsquo;s standard project build setup using <a href="http://www.phing.info/">Phing</a>, we have a task that will run <a href="http://drush.ws/docs/make.txt">drush make</a> when the make file&rsquo;s modified time is newer than the built site. This allows a user to invoke the build tool and only spend the time doing a <code>drush make</code> if the Makefile has indeed changed.</p>

<p>The setup needed to do this in Phing is configured in XML: if an index.php file exists and it is newer than the Makefile, don&rsquo;t run <code>drush make</code>. Otherwise, delete the built site and run <code>drush make</code>. The necessary configuration to do this in a Phing build.xml is below.</p>

<h6>build.xml</h6>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;target</span> <span class="na">name=</span><span class="s">&quot;-drush-make-uptodate&quot;</span> <span class="na">depends=</span><span class="s">&quot;init&quot;</span> <span class="na">hidden=</span><span class="s">&quot;true&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;if&gt;</span>
</span><span class='line'>    <span class="nt">&lt;available</span> <span class="na">file=</span><span class="s">&quot;${html}/index.php&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>    <span class="nt">&lt;then&gt;</span>
</span><span class='line'>      <span class="nt">&lt;uptodate</span> <span class="na">property=</span><span class="s">&quot;drush.makefile.uptodate&quot;</span>
</span><span class='line'>        <span class="na">targetfile=</span><span class="s">&quot;${html}/index.php&quot;</span> <span class="na">srcfile=</span><span class="s">&quot;${drush.makefile}&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/then&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/if&gt;</span>
</span><span class='line'><span class="nt">&lt;/target&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="c">&lt;!-- Use drush make to build (or rebuild) the docroot --&gt;</span>
</span><span class='line'><span class="nt">&lt;target</span> <span class="na">name=</span><span class="s">&quot;drush-make&quot;</span> <span class="na">depends=</span><span class="s">&quot;-drush-make-uptodate, init&quot;</span>
</span><span class='line'>  <span class="na">hidden=</span><span class="s">&quot;true&quot;</span> <span class="na">unless=</span><span class="s">&quot;drush.makefile.uptodate&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;if&gt;</span>
</span><span class='line'>    <span class="nt">&lt;available</span> <span class="na">file=</span><span class="s">&quot;${html}&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>    <span class="nt">&lt;then&gt;</span>
</span><span class='line'>      <span class="nt">&lt;echo</span> <span class="na">level=</span><span class="s">&quot;info&quot;</span> <span class="na">message=</span><span class="s">&quot;Rebuilding ${html}.&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>      <span class="nt">&lt;delete</span> <span class="na">dir=</span><span class="s">&quot;${html}&quot;</span> <span class="na">failonerror=</span><span class="s">&quot;true&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/then&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/if&gt;</span>
</span><span class='line'>
</span><span class='line'>  <span class="nt">&lt;exec</span> <span class="na">executable=</span><span class="s">&quot;drush&quot;</span> <span class="na">checkreturn=</span><span class="s">&quot;true&quot;</span> <span class="na">passthru=</span><span class="s">&quot;true&quot;</span> <span class="na">level=</span><span class="s">&quot;info&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;arg</span> <span class="na">value=</span><span class="s">&quot;make&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>    <span class="nt">&lt;arg</span> <span class="na">value=</span><span class="s">&quot;${drush.makefile}&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>    <span class="nt">&lt;arg</span> <span class="na">value=</span><span class="s">&quot;${html}&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/exec&gt;</span>
</span><span class='line'><span class="nt">&lt;/target&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>You&rsquo;ll note that Phing also uses variable interpolation. The syntax, <code>${html}</code>, is similar to regular PHP string interpolation. By convention, parameters for a Phing build live in a <code>build.properties</code> file.</p>

<h2>A newer grunt</h2>

<p><a href="https://github.com/tschaub/grunt-newer">The grunt-newer plugin</a> appears to be the proper way to handle this. It creates a new task prefixed with <code>newer:</code> to any other defined tasks. If your task has a <code>src</code> and <code>dest</code> parameter, it will check that <code>src</code> is newer than <code>dest</code> before running the task.</p>

<p>In my first quick testing, I added a spurious src parameter to the <code>drush:make</code> task and then invoked the <code>newer:drush:make</code> task.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">grunt</span><span class="p">.</span><span class="nx">config</span><span class="p">(</span><span class="s1">&#39;drush&#39;</span><span class="p">,</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">make</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">args</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;make&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;%= config.srcPaths.make %&gt;&#39;</span><span class="p">],</span>
</span><span class='line'>    <span class="nx">src</span><span class="o">:</span> <span class="s1">&#39;&lt;%= config.srcPaths.make %&gt;&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">dest</span><span class="o">:</span> <span class="s1">&#39;&lt;%= config.buildPaths.html %&gt;&#39;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>That modification worked properly in concert with <code>grunt-newer</code> (and the <code>drush</code> task from <code>grunt-drush</code> task didn&rsquo;t complain about the extra <code>src</code> parameter,) but I still also needed to conditionally run the <code>clean:default</code> and <code>mkdir:init</code> only if the Makefile was newer than the built site.</p>

<h2>Synchronized grunting</h2>

<p>The answer turned out to be to create a composite task using <code>grunt.registerTask</code> and <code>grunt.task.run</code> that combined the three tasks existing tasks and then use the <code>grunt-newer</code> version of that task. The solution looked much like the following.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">grunt</span><span class="p">.</span><span class="nx">registerTask</span><span class="p">(</span><span class="s1">&#39;drushmake&#39;</span><span class="p">,</span> <span class="s1">&#39;Delete and create the site folder, run Drush make.&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">grunt</span><span class="p">.</span><span class="nx">task</span><span class="p">.</span><span class="nx">run</span><span class="p">(</span><span class="s1">&#39;clean:default&#39;</span><span class="p">,</span> <span class="s1">&#39;mkdir:init&#39;</span><span class="p">,</span> <span class="s1">&#39;drush:make&#39;</span><span class="p">);</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>I could then invoke <code>newer:drushmake:default</code> in my <code>Gruntfile.js</code> and only delete and rebuild the site when there were changes to the Makefile.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Ten Lesser-Known Things About Vagrant]]></title>
    <link href="http://smerrill.github.io/blog/2014/01/01/ten-lesser-known-things-about-vagrant/"/>
    <updated>2014-01-01T00:00:00-05:00</updated>
    <id>http://smerrill.github.io/blog/2014/01/01/ten-lesser-known-things-about-vagrant</id>
    <content type="html"><![CDATA[<p>I&rsquo;m a huge fan of <a href="http://www.vagrantup.com">Vagrant</a>, a framework for virtualized development environments. We use Vagrant at <a href="http://www.phase2technology.com">Phase2 Technology</a> to model clients&#8217; hosting environments and to develop Puppet manifests in a testing environment before they even hit the production hosting environment.
I&rsquo;ve had the opportunity recently to sit in #vagrant on Freenode and answer some questions. The #vagrant channel is interesting because the questions end up being a mix of questions on many different topics, but throughout many of them, I&rsquo;ve noticed several things that are generally not well understood, and I thought I&rsquo;d answer them.</p>

<!-- break -->


<p>Since Vagrant is a framework for automating VirtualBox to create local development environments using Linux machines that are provisioned (generally) with a configuration management tool, the following topics all come up in #vagrant:</p>

<ul>
<li>Linux system administration</li>
<li><a href="http://www.opscode.com/chef/">Chef</a></li>
<li><a href="http://www.puppetlabs.com">Puppet</a></li>
<li><a href="https://www.virtualbox.org">VirtualBox</a></li>
<li><a href="https://github.com/jedi4ever/veewee">Veewee</a></li>
</ul>


<p>Here are 8 facts about Vagrant that are not widely known about Vagrant.</p>

<h2>1. The eth0 interface on a VM is a NAT interface and Vagrant runs commands over it</h2>

<h2>2. You can give a Vagrant VM an address on your local network (with some caveats)</h2>

<h2>3. Host-only networking lets you access the guest from the host</h2>

<ul>
<li>Explain difference vs port forwarding</li>
<li>Try and point out vagrant-hostmaster</li>
<li>Explain that iptables can thwart this</li>
</ul>


<h2>4. You can re-run your provisioners without rebooting</h2>

<ul>
<li><code>vagrant provision</code></li>
<li>The provisioners run in order</li>
<li><code>vagrant reload</code> vs <code>vagrant provision</code></li>
</ul>


<h2>5. Public Vagrant boxes use a public keypair (be careful!)</h2>

<h2>6. Vagrant&rsquo;s box management keeps pristine copies of boxes for you</h2>

<h2>7. Moving and cloning your Vagrant projects</h2>

<ul>
<li>The <code>.vagrant</code> file and how it tracks VMs</li>
</ul>


<h2>8. You can use the VirtualBox CLI to manage your machines</h2>

<ul>
<li>A quick <code>VBoxManage</code> primer</li>
<li>Hard stopping a VM</li>
<li>Stopping a VM after you delete a Vagrantfile</li>
</ul>


<h2>9. Vagrant runs pretty much everywhere</h2>

<p>This shouldn&rsquo;t really come as a surprise to anyone, but every time I try out a new platform, Vagrant works flawlessly. This is a tribute to VirtualBox: although it has its warts, it runs pretty much everywhere. Mitchell also has to work around various VirtualBox bugs on <a href="https://github.com/mitchellh/vagrant/commit/e367a8cfd6ecd3b194ab694eea948dfd891b76b9">certain versions of OS X</a> <a href="https://github.com/mitchellh/vagrant/commit/6323a8efd433e6e340a262e89fa3aba86f2e9d4f">and on Windows</a>, so the fact that this all just works transparently is pretty awesome.</p>

<p>Any time I set up a new system, one of the first things I do is set up VirtualBox and see if Vagrant can run on it.  Here&rsquo;s a full list of systems that I have used as a Vagrant host:</p>

<ul>
<li>OS X 10.6 with NFS</li>
<li>OS X 10.7 with NFS</li>
<li>Ubuntu 12.04 with NFS</li>
<li>Ubuntu 12.10 with NFS</li>
<li>Fedora 17 with NFS</li>
<li><ul>
<li>I helped <a href="https://github.com/mitchellh/vagrant/pull/1140">with a patch to make NFS work on Fedora 16+</a>)</li>
</ul>
</li>
<li>Arch Linux with NFS</li>
<li>OmniOS</li>
<li><ul>
<li>I <a href="http://grenadesandwich.com/blog/steven/2012/09/23/omnios-vagrant/">blogged my experience trying this out</a>, and it sounds like <a href="http://omniti.com/">OmniTI</a> is going to make some packages for VirtualBox and Vagrant soon. I am utterly unfamiliar with Illumos/OpenSolaris, so there&rsquo;s probably some work needed here, like an Illumos host class.</li>
</ul>
</li>
<li>Windows 7</li>
<li><ul>
<li>Before I reformatted a netbook to Linux, I tried out Vagrant 1.0.5 with Cygwin, and everything worked smoothly.</li>
</ul>
</li>
</ul>


<h2>10. Vagrant is not (yet) ready to use non-VirtualBox hypervisors yet</h2>

<p>I&rsquo;m including this as a quick way to end this post. Several people have popped into #vagrant and said, &ldquo;I read that Vagrant supports VMWare, or that it will soon!&rdquo;</p>

<p>It is true that the master branch of the Vagrant repository contains code that aims to decouple Vagrant from VirtualBox, but there&rsquo;s not a firm timeline on when other providers will be ready to use. (In addition, running the code on master will reformat your Vagrantfiles, so you&rsquo;ll want to set up a new user to test this.)</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Setting Up Your L(ion)AMP Stack]]></title>
    <link href="http://smerrill.github.io/blog/2014/01/01/setting-up-your-lionamp-stack/"/>
    <updated>2014-01-01T00:00:00-05:00</updated>
    <id>http://smerrill.github.io/blog/2014/01/01/setting-up-your-lionamp-stack</id>
    <content type="html"><![CDATA[<ol>
<li>Install XCode (or just gcc)</li>
<li>Install Homebrew</li>
<li>Brew up some software</li>
<li>Make the LAMP brighter</li>
</ol>


<!-- break -->


<h2>Install XCode (or just gcc)</h2>

<h2>Install Homebrew</h2>

<h2>Brew up some software</h2>

<h2>Make the LAMP brighter</h2>

<h3>Get MySQL configured</h3>

<p>Edit /etc/my.cnf and put the following in:</p>

<p>&#8220;`[mysql]</p>

<h1>Packets.</h1>

<p>max_allowed_packet=16m</p>

<p>[mysqld]</p>

<h1>Packets.</h1>

<p>max_allowed_packet=16m</p>

<h1>Wait timeouts.</h1>

<p>innodb_lock_wait_timeout=600
wait_timeout=600
connect_timeout=10</p>

<h1>Set this as high as possible. On a dedicated server, 60% &ndash; 80% of machine RAM.</h1>

<p>innodb_buffer_pool_size=512m</p>

<h1>Set this to the number of logical cores you have on the database server.</h1>

<p>innodb_thread_concurrency=4</p>

<h1>Turn this on dynamically with a Jenkins job.</h1>

<p>slow_query_log=OFF</p>

<h1>Max number of connections allowed.</h1>

<p>max_connections=400</p>

<h1>Don&rsquo;t run out of file descriptors!</h1>

<p>open_files_limit=32768</p>

<h1>If you set the query cache too high, your server risks severly slowing down and taking tens of seconds after an INSERT due to query cache mutex contention.</h1>

<p>query_cache_limit=1M
query_cache_size=32M</p>

<h1>This allows a long-running query to not hit the network for a while and yet not be killed by MySQL.</h1>

<p>net_read_timeout=3600
net_write_timeout=3600</p>

<h1>This only works with Percona but allows you to pare down which slow queries go to the log.</h1>

<h1>log_slow_filter=tmp_table_on_disk,filesort_on_disk</h1>

<h1>Use InnoDB as the default engine.</h1>

<h1>default_storage_engine = InnoDB</h1>

<h1>default_character_set = utf8</h1>

<h1>collation_server = utf8_general_ci</h1>

<h1>character_set_server = utf8</h1>

<h1>Smaller InnoDB files mean less disk I/O when a new one is created.</h1>

<p>innodb_log_file_size=512m
innodb_log_buffer_size=64m
innodb_file_per_table</p>

<h1>Speed up write performance significantly. You risk losing at most 1 or 2 seconds of data in event of a power loss or other catastrophic failure.</h1>

<p>innodb_flush_log_at_trx_commit=0</p>

<h1>Max temp table size in RAM &ndash; larger can be set in application with a per-session SET.</h1>

<p>max_heap_table_size=64m
tmp_table_size=64m</p>

<h1>Per-session mem settings for sorts, joins, order by etc</h1>

<p>join_buffer_size=2m
sort_buffer_size=2m
read_rnd_buffer_size=2m
read_buffer_size=2m</p>

<h1>Block size inside query cache &ndash; reduce pruning</h1>

<p>query_cache_min_res_unit=1024&#8220;`</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Setting Up Your L(ion)AMP Stack]]></title>
    <link href="http://smerrill.github.io/blog/2014/01/01/setting-up-a-lionamp-stack/"/>
    <updated>2014-01-01T00:00:00-05:00</updated>
    <id>http://smerrill.github.io/blog/2014/01/01/setting-up-a-lionamp-stack</id>
    <content type="html"><![CDATA[<p>Let&rsquo;s say you have upgraded to OS X Lion and you want to set it up to do web development. (I&rsquo;ll assume that you want to do Drupal web development, but this will get you set up for any LAMP application.) There will be a couple of tweaks you&rsquo;ll want to make to get your Lion purring.</p>

<p>In short, here&rsquo;s what you will need to do:</p>

<ol>
<li>Install XCode (or gcc)</li>
<li>Install Homebrew</li>
<li>Brew Some Software</li>
<li>Tune Apache</li>
</ol>


<!-- break -->


<h2>Install XCode (or gcc)</h2>

<h2>Install Homebrew</h2>

<h2>Brew Some Software</h2>

<h2>Tune Apache</h2>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[My Most Egregious Varnish Hack]]></title>
    <link href="http://smerrill.github.io/blog/2014/01/01/my-most-egregious-varnish-hack/"/>
    <updated>2014-01-01T00:00:00-05:00</updated>
    <id>http://smerrill.github.io/blog/2014/01/01/my-most-egregious-varnish-hack</id>
    <content type="html"><![CDATA[<p><a href="http://varnish-cache.org/">Varnish</a> is an amazing piece of open-source software. At <a href="http://treehouseagency.com">Treehouse Agency</a> we use it as a standard part of our hosting stack because of its amazing performance for serving anonymous and static content.</p>

<p>In truth, though, its extreme ease of configuration is another part of its appeal. Perhaps an application that you can&rsquo;t easily change is sending the wrong headers. In that case, just rewrite them on the way back out. Maybe you want to <a href="https://www.varnish-cache.org/trac/wiki/FAQ/Compression#Ithoughtyousaidthiswascomplicated">munge Accept-Encoding headers</a> to get maximum cache hit rates? Varnish handles that with aplomb.</p>

<p>My favorite Varnish story, though, deals with a quick hack I put together to fix what could potentially have been a major PR problem.</p>

<!-- break -->


<h2>Shortening Links For Fun and Profit</h2>

<p>We use <a href="http://bit.ly">bit.ly</a> to shorten <a href="http://treehouseagency.com">Treehouse Agency</a>&rsquo;s links. Specifically, we are using bit.ly&rsquo;s &ldquo;Custom short domain&rdquo; feature to use the <u>tha.cm</u> domain for all of our shortened links. We like bit.ly for its analytics and the fact that a custom short domain is free.</p>

<p>Now let&rsquo;s travel back in time a bit.</p>

<p>In the early spring of 2011, Team Treehouse Agency was preparing for <a href="http://chicago2011.drupal.org/">DrupalCon Chicago</a>. We had just printed up new business cards and promotional materials. We had put a number of URLs into our promotional materials and we were fleshing their content in the days leading up to the conference. One by one, we claimed the URLs on our tha.cm domain as we finished pages.</p>

<h2>&hellip;Oops</h2>

<p>We left the easiest page to produce (content-wise) for last: <a href="http://tha.cm/social">tha.cm/social</a>, which was simply a list of all the Treehouse Agency social media links. When we went to claim this link, however, we discovered one thing that we had overlooked.</p>

<p><strong>Using a bit.ly custom domain does not give you your own pool of unique links.</strong></p>

<p>Stated in another way, tha.cm/social is the same as bit.ly/social is the same as (insert other short domain here)/social, and someone had already claimed this. This was a major problem, because thousands of Treehouse Agency business cards had been printed with that exact link on it.</p>

<h2>Varnish to the rescue!</h2>

<p>We looked at other link-shortening services, but many of them cost too much or didn&rsquo;t offer the same level of analytics that we got from bit.ly. Without a simple switch possible, I implemented a quick 10-minute fix with Varnish.</p>

<p>The way that you implement bit.ly custom short domain support is by setting up a DNS <strong>A</strong> record that points to the URL 168.143.174.97. Therefore, I created a tiny <a href="http://www.rackspace.com/cloud/cloud_hosting_products/servers/">Rackspace Cloud Server</a> and set the DNS for tha.cm to resolve to its IP. I then installed Varnish on it, and configured it almost as a straight-up proxy. Here&rsquo;s the VCL I used:</p>

<div class="highlight"><pre><code class="scala"><span class="n">backend</span> <span class="n">default</span> <span class="o">{</span>
  <span class="o">.</span><span class="n">host</span> <span class="k">=</span> <span class="s">&quot;168.143.174.97&quot;</span><span class="o">;</span>
  <span class="o">.</span><span class="n">port</span> <span class="k">=</span> <span class="s">&quot;80&quot;</span><span class="o">;</span>
<span class="o">}</span>

<span class="n">sub</span> <span class="n">vcl_recv</span> <span class="o">{</span>
  <span class="n">set</span> <span class="n">req</span><span class="o">.</span><span class="n">http</span><span class="o">.</span><span class="n">host</span> <span class="k">=</span> <span class="s">&quot;tha.cm&quot;</span><span class="o">;</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">req</span><span class="o">.</span><span class="n">url</span> <span class="o">==</span> <span class="s">&quot;/social&quot;</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">error</span> <span class="mi">750</span> <span class="s">&quot;Moved Temporarily&quot;</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="n">sub</span> <span class="n">vcl_error</span> <span class="o">{</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">obj</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="mi">750</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">set</span> <span class="n">obj</span><span class="o">.</span><span class="n">http</span><span class="o">.</span><span class="nc">Location</span> <span class="k">=</span> <span class="s">&quot;http://tha.cm/tha-social&quot;</span><span class="o">;</span>
    <span class="n">set</span> <span class="n">obj</span><span class="o">.</span><span class="n">status</span> <span class="k">=</span> <span class="mi">302</span><span class="o">;</span>
    <span class="k">return</span> <span class="o">(</span><span class="n">deliver</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div>


<p>It&rsquo;s really pretty simple. If the requested URL is &ldquo;/social&rdquo;, redirect to the real tha.cm/bit.ly link that we ended up getting. Otherwise, it proxies the request through to 168.143.174.97, which is the address that you would normally put into your domain&rsquo;s DNS anyway.</p>

<p>Varnish&rsquo;s primary role is that of a super-fast reverse proxy cache, but hopefully this post has also shown you that its flexibility can also save you from other sorts of issues.</p>

<p>In our case, it meant that we didn&rsquo;t have to reprint lots of business cards. Chalk up another win for Varnish.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Back to the Future (Or, "A Neckbeard's Progress")]]></title>
    <link href="http://smerrill.github.io/blog/2014/01/01/everything-old-is-new-hotness/"/>
    <updated>2014-01-01T00:00:00-05:00</updated>
    <id>http://smerrill.github.io/blog/2014/01/01/everything-old-is-new-hotness</id>
    <content type="html"><![CDATA[<p>We web developers live in exciting times.</p>

<p>It&rsquo;s hard to believe that <a href="http://smerrill.github.io/blog/steven/2009/10/12/everything-old-new-again" title="My last post along these lines.">nearly two years ago</a>
I wrote a blog post in which I was really starting</p>

<!-- break -->



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Testing Drupal with Ghosts and Gherkins at DrupalCampNJ]]></title>
    <link href="http://smerrill.github.io/blog/2013/02/04/testing-drupal-with-ghosts-and-gherkins-at-drupalcampnj/"/>
    <updated>2013-02-04T00:00:00-05:00</updated>
    <id>http://smerrill.github.io/blog/2013/02/04/testing-drupal-with-ghosts-and-gherkins-at-drupalcampnj</id>
    <content type="html"><![CDATA[<p>This weekend marked the second annual <a href="http://www.drupalcampnj.org/" target="_">DrupalCamp New Jersey</a> at beautiful Princeton University.</p>


<p></p></p>

<p>I was happy to fill in when a presenter dropped out and presented a session called &#8220;Testing Drupal with Ghosts and Gherkins&#8221;. In this presentation, I talked about how both CasperJS or Behat could be brought to bear to test a Drupal application and gave some demos of each. The slides are embedded below.</p>


<p></p></p>

<!--more-->




<p><iframe src="http://www.slideshare.net/slideshow/embed_code/16322739?rel=0" width="427" height="356" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" style="border:1px solid #CCC;border-width:1px 1px 0;margin-bottom:5px" allowfullscreen webkitallowfullscreen mozallowfullscreen> </iframe><br /></p>


<div style="margin-bottom:5px"> <strong> <a href="http://www.slideshare.net/Phase2Technology/testing-withghostsandgherkins" title="Testing Drupal with Ghosts and Gherkin" target="_blank">Testing Drupal with Ghosts and Gherkin</a> </strong> from <strong><a href="http://www.slideshare.net/Phase2Technology" target="_blank">Phase2 Technology</a></strong> </div>


<br />


<p></p></p>

<p>Here are some links to the items demoed in the presentation so that you can give them a shot on your own sites.</p>


<p></p></p>

<p>Information about CasperJS is available at its website, <a href="http://casperjs.org/">casperjs.org</a>. You can read more about CasperJS&#8217;s parent project, PhantomJS, at <a href="http://phantomjs.org/">phantomjs.org</a>.</p>


<p></p></p>

<p>The sample CasperJS scripts adapted from our Testing with Friendly Ghosts presentation are available on GitHub at <a href="https://github.com/ericduran/friendly-ghosts-examples">github.com/ericduran/friendly-ghosts-examples</a>.</p>


<p></p></p>

<p>Similarly, documentation for both Behat and the Mink browser-testing extension is available at <a href="http://behat.org/">behat.org</a>. </p>


<p></p></p>

<p>If you&#8217;d like to try out a sample project that uses Behat and Mink and one custom Mink step definition to test some sample assertions on the Phase2 website, it&#8217;s on GitHub at <a href="https://github.com/phase2/behat-phase2tech/">github.com/phase2/behat-phase2tech/</a>.</p>


<p></p></p>

<p>Finally, our set of Drupal-based Behat and Mink step definitions are released as Open Source on GitHub at <a href="https://github.com/phase2/behat-drupal-extension">github.com/phase2/behat-drupal-extension</a>.</p>


<p></p></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[OmniOS and Vagrant]]></title>
    <link href="http://smerrill.github.io/blog/2012/09/23/omnios-vagrant/"/>
    <updated>2012-09-23T00:00:00-04:00</updated>
    <id>http://smerrill.github.io/blog/2012/09/23/omnios-vagrant</id>
    <content type="html"><![CDATA[<h3>&lt;3 ZFS</h3>

<p>I&rsquo;ve recently gotten religion about ZFS, and as a result, I&rsquo;ve been looking hard at the various systems that offer you the ability to use ZFS and other amazing tools from the Solaris lineage (now being developed freely under <a href="http://blog.illumos.org/">the Illumos moniker</a> after Oracle&rsquo;s unceremonious murder of OpenSolaris.)</p>

<p>My data&rsquo;s backed up on an 8 TB FreeNAS, but there&rsquo;s also an amazing trend of Illumos-based distributions on offer that offer KVM virtualization, which was ported to Illumos by Joyent for <a href="http://smartos.org/">their SmartOS distribution</a>. Theo Schlossnagle recently gave a talk at the NYC DevOps meetup about <a href="http://omnios.omniti.com/">their Illumos-based OmniOS distribution</a>. OmniOS is a bit more than a JeOS &ndash; it aims to provide just enough packaged software to let you build the Illumos kernel and several other important tools like tmux and screen, and then get out of your way. Like SmartOS, it provides both lightweight zones-based virtualization and KVM for full hardware virtualization, but OmniOS is designed to be permanently installed on a machine, as opposed to SmartOS&rsquo;s focus on USB or PXE booting and ephemeral global zone configuration.</p>

<p>OmniTI also makes a larger set of packages that their Managed Services team uses at <a href="http://pkg.omniti.com/omniti-ms/en/index.shtml">http://pkg.omniti.com/omniti-ms/en/index.shtml</a>.</p>

<!--more-->


<h3>KVM? Not today.</h3>

<p>But at the end of the day, <a href="http://vagrantup.com/">Vagrant</a> is still the platform I use to run applications with the correct operating system, software versions, and production configurations, so I need Vagrant (and thus <a href="https://www.virtualbox.org/">VirtualBox</a>) to run on my workstation.</p>

<p>I am happy to report that I was able to get VirtualBox and Vagrant to the point that they could boot a box, and use host-only networking despite being a complete UNIX and Solaris noob. (Thanks to Mitchell and the whole Vagrant community for an awesome piece of software.)</p>

<h3>Get it installed</h3>

<p>Here&rsquo;s the roundup on how to get it all up and running. All commands were run as root in the global zone.</p>

<p>Install a few utility packages. This is not strictly necessary, but it helps.</p>

<pre><code>$ pkg install terminal/tmux
$ pkg install developer/versioning/git
</code></pre>

<p>Set up a static IP as pointed out in <a href="http://omnios.omniti.com/wiki.php/GeneralAdministration.">http://omnios.omniti.com/wiki.php/GeneralAdministration.</a> In my case, it was 192.168.0.160.</p>

<p>You will also need to set up your gateway as a DNS resolver. To do so on UNIX, add at least a <em>search</em> and <em>nameserver</em> to /etc/resolv.conf. I am using the following:</p>

<pre><code>search nyc.rr.com
nameserver 192.168.0.1
</code></pre>

<p>Set up NSS to read resolv.conf.</p>

<pre><code>$ cp /etc/nsswitch.{dns,conf}
</code></pre>

<p>Add the OmniTI managed services package repo to make getting a few things easier.</p>

<pre><code>$ pkg set-publisher -g http://pkg.omniti.com/omniti-ms/ ms.omniti.com
</code></pre>

<p>Rebuild the package index</p>

<pre><code>$ pkg rebuild-index
</code></pre>

<p>Install Ruby and gcc 4.6 to be able to build gem extensions. Also ensure libffi is there since Vagrant needs the ffi gem.</p>

<pre><code>$ pkg install omniti/runtime/ruby-19
$ pkg install developer/gcc46
$ pkg install library/libffi
</code></pre>

<p>At this point you should be ready to install the Vagrant gem. The Ruby 1.9 executables like <code>gem</code> and <code>irb</code> get put into <code>/opt/omni/bin/</code>.</p>

<pre><code>$ /opt/omni/bin/gem install vagrant
</code></pre>

<p>Run a quick <code>vagrant help</code> to ensure that everything&rsquo;s hooked up properly.</p>

<pre><code>$ /opt/omni/lib/ruby/gems/1.9.1/gems/vagrant-1.0.5/bin/vagrant help
</code></pre>

<p>Next up we need to install VirtualBox. I saw <a href="https://gist.github.com/7ddfa72c1d97198532ea">errors related to the Crossbow-based networking kernel module</a> while trying to install a variety of versions of VirtualBox, so we can <a href="http://www.virtualbox.org/manual/ch09.html#vboxbowsolaris11">force the older stream-based VirtualBox networking driver to install</a>.</p>

<pre><code>$ touch /etc/vboxinst_vboxflt
</code></pre>

<p>With that in place, download and extract the VirtualBox 4.2.0 release for Solaris guests.</p>

<pre><code>$ wget http://download.virtualbox.org/virtualbox/4.2.0/VirtualBox-4.2.0-80737-SunOS.tar.gz
$ tar xzf VirtualBox-4.2.0-80737-SunOS.tar.gz
</code></pre>

<p>Next up, install the package.</p>

<pre><code>$ pkgadd -d VirtualBox-4.2.0-SunOS-r80737.pkg
</code></pre>

<p>At this point you should be ready to download a Vagrantfile and go. I&rsquo;ve made <a href="https://gist.github.com/0509301bb7c62e523b49">a sample one</a> that you can try with.</p>

<pre><code>$ curl https://raw.github.com/gist/0509301bb7c62e523b49/87e75688b45631ca9492123c5f160d2311e84604/gistfile1.rb &gt; Vagrantfile
$ /opt/omni/lib/ruby/gems/1.9.1/gems/vagrant-1.0.5/bin/vagrant up
$ /opt/omni/lib/ruby/gems/1.9.1/gems/vagrant-1.0.5/bin/vagrant ssh
</code></pre>

<p>And with that, the box should download and the second command should have you logged in as the <code>vagrant</code> user on your very own Ubuntu 12.04 LTS VM.</p>

<h3>Host-only networking</h3>

<p>There is one peculiarity to VirtualBox on OmniOS (which, granted, might be VirtualBox on Solaris/Illumos &ndash; I have no idea.) Windows, Mac, and Linux hosts all have the ability to create a host-only interface with the <code>VBoxManage hostonlyif create</code> command-line option. That option does not exist in the Solaris version of VirtualBox. In my experience from this weekend, VirtualBox will create you a <code>vboxnet0</code> interface which can be used as a host-only network. If you do wish to use host-only networking with your VM, you will have to set it up before you run <code>vagrant up</code>.</p>

<p>I usually run my host-only interfaces inside of 172.16.0.0/12. For the sake of argument, let&rsquo;s say we want to give this VM a host-only address of 172.31.31.31. (The sample Vagrantfile has this configuration commented out.) By setting the IP address of <code>vboxnet0</code> to 172.31.31.1, vagrant will not try to run <code>VBoxManage hostonlyif create</code>, and host-only networking will also work. The <code>VBoxManage</code> command to do so is as follows:</p>

<pre><code>$ VBoxManage hostonlyif ipconfig vboxnet0 -ip 172.31.31.1
</code></pre>

<h3>Not exhaustive</h3>

<p>I haven&rsquo;t tried out a full client setup though Vagrant on OmniOS yet, and I think I&rsquo;ll still be booting my workstation into Fedora 17 for the next week to run KVM and/or VirtualBox VMs. Here are the remaining things that I&rsquo;d need to nail down before I could use OmniOS and Vagrant together:</p>

<ul>
<li>There&rsquo;s no Solaris host class in Vagrant, so the ability to export files (like your codebase) from the host to the guest via NFS won&rsquo;t work yet. That said, since ZFS has deep hooks into NFS, this might be super simple to implement assuming that you boot from ZFS.</li>
<li>The host-only networking bit is strange, and I don&rsquo;t know enough about OmniOS or Crossbow to say what&rsquo;s going on.</li>
<li>I haven&rsquo;t tested out applying Puppet or Chef configuration to the guest. OmniTI <a href="http://pkg.omniti.com/omniti-ms/info/0/omniti%2Fsystem%2Fmanagement%2Fchef%400.10.8%2C5.11-0.151002%3A20120501T192332Z">makes a Chef package available</a> in the managed services repository, and the Puppet and Facter gems install without issue, so this should be rather painless.</li>
<li>VirtualBox should probably be run <a href="http://www.virtualbox.org/manual/ch02.html#idp11597936">in its own zone</a>.</li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Access PHP, MySQL, jQuery, and Drupal documentation offline on your Mac with Dash]]></title>
    <link href="http://smerrill.github.io/blog/2012/05/31/access-php-mysql-jquery-and-drupal-documentation-offline-on-your-mac-with-dash/"/>
    <updated>2012-05-31T00:00:00-04:00</updated>
    <id>http://smerrill.github.io/blog/2012/05/31/access-php-mysql-jquery-and-drupal-documentation-offline-on-your-mac-with-dash</id>
    <content type="html"><![CDATA[<p>Wouldn&#8217;t it be great if there was an easy way to access php.net or other documentation offline or on a plane?</p>


<p></p></p>

<p><strong>UPDATE:</strong> Sadly, as this blog post went to press, two important updates came out that change the usefulness of this blog post. Dash is now ad-supported, and secondly, it ships with a Drupal DocSet available for download, so that&#8217;s one fewer step you have to perform to have all the docs that matter to you in Dash.</p>


<p></p></p>

<!--more-->




<p>There&#8217;s a free as in beer application called Dash (available on the Mac App Store at <a href="http://itunes.apple.com/us/app/dash/id458034879?ls=1&mt=12" title="http://itunes.apple.com/us/app/dash/id458034879?ls=1&mt=12">http://itunes.apple.com/us/app/dash/id458034879?ls=1&mt=12</a>) available for Mac OS X. Dash is a nice-looking documentation browser featuring several useful features, such as the ability to query it with a custom URL string (dash://YOURQUERY), which lends itself for use in tools like Alfred.</p>


<p></p></p>

<p>Dash can also download additional documentation sets for many open source technologies, including MySQL, PHP, and jQuery. It can be handy to search through the latest PHP API documentation no matter what kind of connection you&#8217;re on, like so:</p>


<br />


<p><a href="https://skitch.com/00sven/87u7b/dash-documentation"><img src="https://img.skitch.com/20120530-ttupxms7g3b48xep9yu3qk8rs2.medium.jpg" alt="Dash - Documentation" /></a></p></p>

<p>In addition, Dash also has the ability to browse any API documentation that you have installed through XCode onto your system. (In fact, any files in DocSet format that are located inside the ~/Library/Developer/Shared/Documentation/DocSets directory can be read by Dash.)</p>


<p></p></p>

<p>In addition to the freely available DocSets that are available for major open-source technologies, it&#8217;s easy to make your own DocSets using doxygen. I went ahead and made a DocSet for Drupal 7.x using doxygen. Not every method that&#8217;s available at api.drupal.org is here, but it&#8217;s a great start, especially if you want a single offline app where you can query offline documentation.</p>


<p></p></p>

<p>To start using the Drupal DocSet, download the .tgz file from <a href="https://github.com/phase2/drupal-docset/zipball/master" title="https://github.com/phase2/drupal-docset/zipball/master">https://github.com/phase2/drupal-docset/zipball/master</a>. To use it:</p>


<p></p></p>

<ol>
<li>Unzip the file</li>
<li>Move org.drupal.docset to ~/Library/Developer/Shared/Documentation/DocSets/</li>
<li>Launch Dash and start searching, like so.</li><br />
</ol>


<br />


<p><a href="https://skitch.com/00sven/87u44/dash-documentation"><img src="https://img.skitch.com/20120530-rrgw89tfht2g7ie3ejys98xssr.medium.jpg" alt="Dash - Documentation" /></a></p></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Coat Your Website with Varnish at DrupalCamp MD]]></title>
    <link href="http://smerrill.github.io/blog/2012/02/10/coat-your-website-with-varnish-at-drupalcamp-md/"/>
    <updated>2012-02-10T00:00:00-05:00</updated>
    <id>http://smerrill.github.io/blog/2012/02/10/coat-your-website-with-varnish-at-drupalcamp-md</id>
    <content type="html"><![CDATA[<p>The Drupal community is exploding! I&#8217;ve had the pleasure to speak at two nascent Drupal camps (<a href="http://www.drupalcampnj.org/">New Jersey</a> and <a href="http://drupalcampmd.org/">Maryland</a>) in as many weeks.</p>


<p></p></p>

<p>Today I gave a revamped version of my <a href="http://drupalcampmd.org/sessions/coat-your-website-varnish">&#8220;Coat Your Website with Varnish&#8221; session at DrupalCamp MD</a>. I updated some of the information about Drupal configuration and an overview section going over some of the basics of headers and caching.</p>


<p></p></p>

<p>The entire presentation is embedded below and is also available <a href="http://prezi.com/lgk2q71ez9iv/coat-your-website-in-varnish-maryland/">on Prezi.com</a>.</p>


<p></p></p>

<!--more-->




<div class="prezi-player">
<style type="text/css" media="screen">.prezi-player { width: 550px; } .prezi-player-links { text-align: center; }</style><object id="prezi_lgk2q71ez9iv" name="prezi_lgk2q71ez9iv" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="550" height="400"><param name="movie" value="http://prezi.com/bin/preziloader.swf"/><param name="allowfullscreen" value="true"/><param name="allowscriptaccess" value="always"/><param name="bgcolor" value="#ffffff"/><param name="flashvars" value="prezi_id=lgk2q71ez9iv&lock_to_path=0&color=ffffff&autoplay=no&autohide_ctrls=0"/><embed id="preziEmbed_lgk2q71ez9iv" name="preziEmbed_lgk2q71ez9iv" src="http://prezi.com/bin/preziloader.swf" type="application/x-shockwave-flash" allowfullscreen="true" allowscriptaccess="always" width="550" height="400" bgcolor="#ffffff" flashvars="prezi_id=lgk2q71ez9iv&lock_to_path=0&color=ffffff&autoplay=no&autohide_ctrls=0"></embed></object>
<div class="prezi-player-links">
<p><a title="Coat Your Website in Varnish Maryland" href="http://prezi.com/lgk2q71ez9iv/coat-your-website-in-varnish-maryland/">Coat Your Website in Varnish Maryland</a> on <a href="http://prezi.com">Prezi</a></p><br />
</div><br />
</div>


<p></p></p>

<p>In addition, if you&#8217;d like to get hands-on experience with a number of techniques to make your Drupal site perform like a champion, I&#8217;m honored to be co-presenting the <a href="http://denver2012.drupal.org/content/drupal-performance-and-scalability">Drupal Performance and Scalability training</a> alongside <a href="http://denver2012.drupal.org/users/msonnabaum">Mark Sonnabaum from Acquia</a> and <a href="http://drupal.org/user/35821">Nate Haug from Lullabot</a>!</p>


<p></p></p>

<p>See you in Denver, and until then, Varnish <u>all</u> the things!</p>


<p></p></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Let&#039;s Be Upfront About Performance at DrupalCamp NJ]]></title>
    <link href="http://smerrill.github.io/blog/2012/02/04/lets-be-upfront-about-performance-at-drupalcamp-nj/"/>
    <updated>2012-02-04T00:00:00-05:00</updated>
    <id>http://smerrill.github.io/blog/2012/02/04/lets-be-upfront-about-performance-at-drupalcamp-nj</id>
    <content type="html"><![CDATA[<p>I just presented <a href="http://www.drupalcampnj.org/sessions/lets-be-upfront-about-performance">&#8220;Let&#8217;s Be Upfront About Performance&#8221;</a> as a session at <a href="http://www.drupalcampnj.org/">the inaugural DrupalCamp NJ</a>.</p>


<p></p></p>

<p>My presentation is embedded below. Go forth and make fast websites!</p>


<p></p></p>

<!--more-->




<div class="prezi-player">
<style type="text/css" media="screen">.prezi-player { width: 550px; } .prezi-player-links { text-align: center; }</style><object id="prezi_hmxsbzfz2shk" name="prezi_hmxsbzfz2shk" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="550" height="400"><param name="movie" value="http://prezi.com/bin/preziloader.swf" /><param name="allowfullscreen" value="true" /><param name="allowscriptaccess" value="always" /><param name="bgcolor" value="#ffffff" /><param name="flashvars" value="prezi_id=hmxsbzfz2shk&lock_to_path=0&color=ffffff&autoplay=no&autohide_ctrls=0" /><embed id="preziEmbed_hmxsbzfz2shk" name="preziEmbed_hmxsbzfz2shk" src="http://prezi.com/bin/preziloader.swf" type="application/x-shockwave-flash" allowfullscreen="true" allowscriptaccess="always" width="550" height="400" bgcolor="#ffffff" flashvars="prezi_id=hmxsbzfz2shk&lock_to_path=0&color=ffffff&autoplay=no&autohide_ctrls=0"></embed></object>
<div class="prezi-player-links">
<p><a title="Let's Be Upfront About Performance NJ" href="http://prezi.com/hmxsbzfz2shk/lets-be-upfront-about-performance-nj/">Let&#8217;s Be Upfront About Performance NJ</a> on <a href="http://prezi.com">Prezi</a></p><br />
</div><br />
</div>


<p></p></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Bonjour, mes amis!]]></title>
    <link href="http://smerrill.github.io/blog/2012/01/16/bonjour-mes-amis/"/>
    <updated>2012-01-16T00:00:00-05:00</updated>
    <id>http://smerrill.github.io/blog/2012/01/16/bonjour-mes-amis</id>
    <content type="html"><![CDATA[<p>Apple&rsquo;s <a href="http://developer.apple.com/library/mac/#documentation/Cocoa/Conceptual/NetServices/Introduction.html#//apple_ref/doc/uid/10000119i">Bonjour</a> service just saved me a lot of hassle.</p>

<p>I took a little time this MLK Day to get some old electronics ready for sale. One of the machines I decided to clean up was an old Mac Pro. I&rsquo;ve recently replaced it with a <a href="http://www.apple.com/macmini/server/">Mac mini</a> that positively sips power: 10 &ndash; 12 watts at idle instead of the consistent 120 watts that my old Mac Pro would draw. (I&rsquo;ll write more on cutting my setup&rsquo;s power consumption in a later blog post.)</p>

<p>I hooked my Mac Pro up to my router with an Ethernet cable but didn&rsquo;t want to get out a keyboard, mouse, and monitor to do a final set of backups and deauthorize some software. Normally this wouldn&rsquo;t be a problem since the old Mac Pro was set configured to start Apple Remote Desktop at boot.</p>

<p>I forgot that since switching to the Mac Pro, I had reassigned the Mac Pro&rsquo;s IP address (192.168.0.150) to the Mac mini. The Mac Pro booted, but could not get a proper IP address since the address it was configured to use was in use.</p>

<p>I was about to break out my keyboard, mouse, and monitor when I thought I&rsquo;d give Bonjour a try.</p>

<!--more-->


<h2>Saying &lsquo; <em>Bonjour!</em> &rsquo; sans IP address</h2>

<p>The Mac Pro in question was configured with a machine name of <code>Terawattson</code>. I knew that Bonjour would advertise <code>Terawattson.local</code> over the network to capable clients, but wasn&rsquo;t sure if that would work when the machine didn&rsquo;t have a proper IP address. On a lark, I gave it a shot, and it worked.</p>

<div class="highlight"><pre><code class="text"> smerrill@Tinier-Shinier [Jan 16 12:23:22] ~
  ssh Terawattson.local
Last login: Mon Jan 16 12:56:57 2012
 smerrill@Terawattson [Jan 16 12:58:22] ~
 
</code></pre></div>


<p>Even better, this meant that I could use an SSH tunnel over Bonjour networking to tunnel to port 5900 (where the Apple Remote Desktop service lives, just like VNC) and graphically access the Network control panel to switch IP addresses.</p>

<div class="highlight"><pre><code class="text"> smerrill@Tinier-Shinier:1 [Jan 16 12:56:55] ~
  ssh -N Terawattson.local -L 5901/localhost/5900
</code></pre></div>


<p>With that SSH tunnel in place, I went into the Finder and with a single &ldquo;Connect to Server&rdquo;, I had a session on the Mac Pro in OS X&rsquo;s Screen Sharing.app.</p>

<p><img src="https://img.skitch.com/20120116-f45bhy6g7bprfjgug1818f8xn9.jpg" alt="Connecting to vnc://localhost:5901 over the SSH tunnel" /></p>

<p>Using the graphical connection I set a new IP address, deauthorized Adobe CS4, iTunes, and a couple other programs, and started up an rsync backup to the new Mac mini.</p>

<p>I hope this post helps you out if you ever have trouble with a headless Mac.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Using HipChat through an IRC client with BitlBee]]></title>
    <link href="http://smerrill.github.io/blog/2011/12/15/using-hipchat-through-an-irc-client-with-bitlbee/"/>
    <updated>2011-12-15T00:00:00-05:00</updated>
    <id>http://smerrill.github.io/blog/2011/12/15/using-hipchat-through-an-irc-client-with-bitlbee</id>
    <content type="html"><![CDATA[<p>Here at Treehouse Agency, we love IRC, as does the rest of the Drupal community. Still, IRC ports are often blocked, and not everyone is comfortable using IRC. We&#8217;ve recently been using <a href="http://www.hipchat.com/">HipChat</a> to set up chat rooms for certain new clients.</p>


<p></p></p>

<p>I already route most of my AIM and GTalk interaction through an IRC gateway using <a href="http://www.bitlbee.org/">BitlBee</a>, and I wanted to hook HipChat up to an IRC client as well. Here&#8217;s a guide on how to do this.</p>


<p></p></p>

<p>(Note that I was having trouble joining channels in my LimeChat last night as I was writing this up, but I might just be missing something. Try it out!)</p>


<p></p></p>

<!--more-->




<p>All the uppercase items come from the <a href="https://www.hipchat.com/account/xmpp">XMPP Account Settings page</a> in your HipChat account.</p>


<p></p></p>

<ol>
<li>Add the account in Bitlbee.
<ul>
<li><code>account add jabber USERNAME@chat.hipchat.com 'PASSWORD'</code></li><br />
</ul><br />
</li></p>
<li>Before you connect, set it up so that folks&#8217; chat names will display properly.
<ul>
<li><code>account hipchat set nick_source full_name</code></li><br />
</ul><br />
</li></p>
<li>To prevent being spammed with room history every time you join or change status, set your resource to &#8216;bot&#8217;.
<ul>
<li><code>account hipchat set resource bot</code></li><br />
</ul><br />
</li></p>
<li>Connect to the account.
<ul>
<li><code>account hipchat on</code></li><br />
</ul><br />
</li></p>
<li>At this point, you can join the &hipchat channel to see all your contacts and use /msg to start talking w/ one of them privately.
<ul>
<li><code>/join &hipchat</code></li><br />
</ul><br />
</li></p>
<li>Now, add a chat. Note that the information on the XMPP settings pages doesn&#8217;t give you @chat.hipchat.com. You can set whatever channel name you want.
<ul>
<li><code>chat add hipchat JABBERNAME@chat.hipchat.com #CHANNELNAME</code></li><br />
</ul><br />
</li></p>
<li>Before you can join, you must set your nick to match the <strong>Room nickname</strong> setting in your XMPP settings. You must do this for every room. Use the channel name you decided on earlier for easier access.
<ul>
<li><code>channel #CHANNELNAME set nick 'ROOM NICKNAME'</code></li><br />
</ul><br />
</li></p>
<li>Now, join the channel.
<ul>
<li><code>/join #CHANNELNAME</code></li><br />
</ul><br />
</li></p>
<li>Start chatting!
<ul>
<li><code>Hey everybody!</code></li>
<li><code>I'm using IRC!</code></li>
<li><code>(fry)</code></li>
<li><code>/me likes IRC and HipChat</code></li><br />
</ul><br />
</li></p>
<li>When you&#8217;re ready to sign out of HipChat, use <code>account off</code>.
<ul>
<li><code>account hipchat off</code></li><br />
</ul><br />
</li><br />
</ol>


<p></p></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Vagrant and NFS]]></title>
    <link href="http://smerrill.github.io/blog/2011/11/17/vagrant-and-nfs/"/>
    <updated>2011-11-17T00:00:00-05:00</updated>
    <id>http://smerrill.github.io/blog/2011/11/17/vagrant-and-nfs</id>
    <content type="html"><![CDATA[<p>One of the most useful features of Vagrant is that it has the ability to share files with the VMs it manages, which lets your team work with the tools they&rsquo;re used to while still getting the benefits of running the full production stack.</p>

<p>It can share those files from the host (the machine running VirtualBox and Vagrant) to the guest (the virtualized Linux machine) via VirtualBox&rsquo;s built-in file sharing on Mac, Windows, or Linux. When run on Linux or Mac hosts, it can also share files to the guest via NFS.  NFS performs much better for sharing large numbers of files on a Linux or Mac host, which is <a href="http://vagrantup.com/docs/nfs.html">well documented in the excellent Vagrant documentation</a>. In addition, remember that the directory with the Vagrantfile in it will be shared with VirtualBox&rsquo;s built-in file sharing, so we probably don&rsquo;t want to put our docroot right in that directory.</p>

<!--more-->


<p>As a result, we usually set up our project directories to look like the following with the docroot one level up from the directory with the Vagrantfile in it. (The docroot can be a symlink or a real copy of the docroot &ndash; it is in the .gitignore file so it won&rsquo;t be committed.)</p>

<p><img src="https://img.skitch.com/20111117-j5tdm5q6pw584sfnnafxrtawb8.jpg" alt="Vagrant setup with the treehouseagency.com folder on the same level as the folder that contains the Vagrantfile" /></p>

<p>There&rsquo;s a few gotchas with using NFS folders:
&ndash; If you try to export a symlink, <code>nfsd</code> will complain. You need to dereference any symlinks before they are put in /etc/exports. The sample code below avoids that.</li>
&ndash; Vagrant automatically uses NFS&rsquo;s mapall to ensure that all file access on the guest maps to your user and group on the host. This will mean that the users and groups may look wrong on the VM (and and <code>chown</code> or <code>chgrp</code> commands will fail), but software on the VM will be able to write to everything in that directory.</p>

<p>Finally, here&rsquo;s some stub code for setting up a vagrant project with a docroot one level up. It takes care of dereferencing any symlinks and sharing the docroot with the guest. It will share it with NFS if the host is a Linux or Mac machine.</p>

<div class="highlight"><pre><code class="ruby"><span class="c1"># Set up some variables relating to which path Vagrant will try to share</span>
<span class="c1"># with the VM.</span>
<span class="nb">require</span> <span class="s1">&#39;pathname&#39;</span>
<span class="vg">$docroot_name</span> <span class="o">=</span> <span class="s2">&quot;treehouseagency.com&quot;</span>
<span class="vg">$docroot_path</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<span class="c1"># Test that the directory to be shared is in the right place and if it is,</span>
<span class="c1"># calculate the fully dereferenced path (since NFS exports will fail if you</span>
<span class="c1"># try to specify the path to a symlink.)</span>
<span class="k">if</span> <span class="o">!</span><span class="no">File</span><span class="o">.</span><span class="n">exists?</span><span class="p">(</span><span class="s2">&quot;../</span><span class="si">#{</span><span class="vg">$docroot_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">then</span>
  <span class="nb">puts</span> <span class="s2">&quot;Please put the &#39;%s&#39; directory (or a symlink to it) in the &#39;%s/&#39; directory.&quot;</span> <span class="o">%</span>
    <span class="o">[</span><span class="vg">$docroot_name</span><span class="p">,</span> <span class="no">Pathname</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;../&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">realpath</span><span class="o">.</span><span class="n">to_s</span><span class="o">]</span>
  <span class="nb">exit</span> <span class="mi">1</span>
<span class="k">else</span>
  <span class="vg">$docroot_path</span> <span class="o">=</span> <span class="no">Pathname</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;../</span><span class="si">#{</span><span class="vg">$docroot_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">realpath</span><span class="o">.</span><span class="n">to_s</span>
<span class="k">end</span>
<span class="ss">Vagrant</span><span class="p">:</span><span class="ss">:Config</span><span class="o">.</span><span class="n">run</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
  <span class="c1"># Add in the rest of your config here.</span>
  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">share_folder</span> <span class="s2">&quot;tha-docroot&quot;</span><span class="p">,</span> <span class="s2">&quot;/tha-docroot&quot;</span><span class="p">,</span> <span class="vg">$docroot_path</span><span class="p">,</span> <span class="ss">:nfs</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="no">RUBY_PLATFORM</span> <span class="o">=~</span> <span class="sr">/linux/</span> <span class="ow">or</span> <span class="no">RUBY_PLATFORM</span> <span class="o">=~</span> <span class="sr">/darwin/</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div>


<p>Enjoy!</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Drush phpsh Integration Demonstration]]></title>
    <link href="http://smerrill.github.io/blog/2011/11/14/drush-phpsh-integration-demonstration/"/>
    <updated>2011-11-14T00:00:00-05:00</updated>
    <id>http://smerrill.github.io/blog/2011/11/14/drush-phpsh-integration-demonstration</id>
    <content type="html"><![CDATA[<p>I gave a 5-minute lightning presentation at the October 2011 <a href="http://groups.drupal.org/nyc">Drupal NYC</a> meetup about <a href="http://drupal.org/project/phpsh">Roger Lop&eacute;z&#8217;s phpsh plugin for drush</a>.</p>


<p></p></p>

<p><a href="http://phpsh.org/">phpsh</a> is a project by Facebook that provides a much more useful REPL (read-eval-print-loop) environment for PHP, similar to <a href="http://ruby-lang.org/">Ruby</a> or <a href="http://www.scala-lang.org/">Scala</a>. The Drush phpsh plugin adds an easy way to generate ctags for code completion in your phpsh (as well as <a href="http://www.vim.org">your favorite editor</a>) and a way to run a persistent PHP session with a fully bootstrapped Drupal instance. It&#8217;s really useful for testing out APIs.</p>


<p></p></p>

<p>If you missed it in person, you can watch the video embedded below.</p>


<p></p></p>

<!--more-->




<p><iframe src="http://player.vimeo.com/video/31983526?title=0&byline=0&portrait=0" width="400" height="290" frameborder="0" webkitAllowFullScreen allowFullScreen></iframe></p>


<p></p></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[End "Works on My Machine" Surprises with Vagrant]]></title>
    <link href="http://smerrill.github.io/blog/2011/11/02/end-works-on-my-machine-surprises-with-vagrant/"/>
    <updated>2011-11-02T00:00:00-04:00</updated>
    <id>http://smerrill.github.io/blog/2011/11/02/end-works-on-my-machine-surprises-with-vagrant</id>
    <content type="html"><![CDATA[<p>How many times have the following issues happened on a project you&#8217;ve worked on?</p>


<p></p></p>

<ul>
<li>Notices (or worse) appeared on production because of a PHP version mismatch between a developer&#8217;s machine and the production web servers.</li>
<li>A new PHP extension or PECL extension had to be installed on production because it was installed in WAMP or MAMP?</li>
<li>A team member ran into difficult setting up their local environment and spent many hours stuck on something.</li>
<li>Team members didn&#8217;t set up SSL or Varnish on their local machines and issues had to be caught on a dev server.</li>
<li>A team member would like to switch to Homebrew, but can&#8217;t set aside the many hours to redo their setup until a project is done.</li><br />
</ul>


<p></p></p>

<!--more-->




<p>Tools like <a href="http://www.mamp.info/en/index.html">MAMP</a>, <a href="http://www.apachefriends.org/en/xampp.html">XAMPP</a>, the <a href="http://network.acquia.com/downloads">Aqcuia dev desktop</a>, <a href="http://www.macports.org/">MacPorts</a> and <a href="http://mxcl.github.com/homebrew/">Homebrew</a> all make it easy to get an *AMP stack up and running on your computer, and tools like MacPorts and Homebrew even make it pretty easy to install tools like <a href="https://www.varnish-cache.org/">Varnish</a> and <a href="http://memcached.org/">memcached</a>.</p>


<p></p></p>

<p>While these tools make it easy to run a very close approximation of the production hosting stack on your local machine (arguably closer if you use Macintosh or Linux,) it will still have some key differences which will ultimately contribute at some point to a &#8221;<a href="http://www.codinghorror.com/blog/2007/03/the-works-on-my-machine-certification-program.html">Works on My Machine!</a>&#8221; situation in your project.</p>


<p></p></p>

<p><img alt="Works On My Machine Badge" src="http://treehouseagency.com/sites/treehouseagency.com/files/worksonmymachine_0.png" style="border: medium none; display: block; float: left;" /></p>


<p></p></p>

<p>Luckily, virtualization has advanced to such a degree that there are cross-platform virtualization solutions such as <a href="https://www.virtualbox.org/">VirtualBox</a>, but just using a VM inside of VirtualBox doesn&#8217;t solve the whole problem. It makes acquiring the correct versions of software easy, but keeping configuration in sync can still be a challenge for users who are not deeply familiar with Linux.</p>


<p></p></p>

<p>Enter <a href="http://vagrantup.com/">Vagrant</a>.</p>


<p></p></p>

<p>Vagrant is a Ruby gem that makes working with Linux virtual machines easy. You distribute a Vagrantfile to your team, and it does the following things for you:</p>


<p></p></p>

<ul>
<li>Downloads and sets up virtual machines from a single .box file which it will download over HTTP or FTP.</li>
<li>Provisions the software and configuration on the VM using your choice of Chef, Puppet, or simple shell scripts</li>
<li>Automatically shares the directory with the Vagrantfile (and any subdirectories) to the virtual machine with Virtualbox&#8217;s built-in file sharing</li>
<li>Forwards the SSH port (and optionally other ports) to your localhost and avoids collisions so you can always directly SSH to the machine</li>
<li>Optionally sets up a dedicated host-only IP address that you can use to connect to all services on the VM without port forwarding</li>
<li>Optionally shares directories to the VM over NFS from a Macintosh or Linux guest, which enables acceptable performance for a Drupal docroot</li><br />
</ul>


<p></p></p>

<p>Since Vagrant handles the file sharing with the VM, you and your team don&#8217;t have to mess around with setting up FUSE or the like and you can continue to use the tools that you&#8217;re used to using locally, such as your text editor or garphical source control program.</p>


<p></p></p>

<p>In addition, so long as you have a single developer skilled in ops who can encapsulate the production configuration into a system like Chef or Puppet, these changes can be pushed down to the whole team. Once your ops team has a working Varnish configuration, for example, they can push that into the Vagrant repository, and then a working Varnish setup on all your developers&#8217; VMs is just a <code>git pull</code> and a <code>vagrant provision</code> away.</p>


<p></p></p>

<p>We&#8217;ve been working with Vagrant over the last few months and think it offers a number of advantages. All it takes to get started installing VirtualBox and the <strong>vagrant</strong> ruby gem. Detailed information on how to get started is available in the excellent <a href="http://vagrantup.com/docs/getting-started/index.html">Vagrant Quickstart guide</a>.</p>


<p></p></p>

<p>I&#8217;ve put together a screencast that&#8217;s just over 10 minutes long and shows the whole process of bringing up a CentOS 5.6 VM with the <a href="http://treehouseagency.com">treehouseagency.com</a> site shared from my local machine.</p>


<p></p></p>

<p><iframe src="http://player.vimeo.com/video/31494273?title=0&byline=0&portrait=0&color=ff9933" width="595" height="446" frameborder="0" webkitAllowFullScreen allowFullScreen></iframe></p>


<p></p></p>

<p>We&#8217;ll be posting more example code over the coming weeks that will allow you to try out Drupal from your local machine on a Linux VM.</p>


<p></p></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Ensuring your Vagrant's box is weatherproof: A quick Veewee tip]]></title>
    <link href="http://smerrill.github.io/blog/2011/10/28/ensuring-your-vagrants-box-is-weatherproof-a-quick-veewee-tip/"/>
    <updated>2011-10-28T00:00:00-04:00</updated>
    <id>http://smerrill.github.io/blog/2011/10/28/ensuring-your-vagrants-box-is-weatherproof-a-quick-veewee-tip</id>
    <content type="html"><![CDATA[<p>We&rsquo;ll be doing a screencast series soon on using the <a href="http://www.vagrantup.com/">Vagrant gem</a> to distribute and manage virtual machines so that your entire team (yes, even Windows folks!) can do development on their local machine with the same software that&rsquo;s on your production Linux servers.</p>

<p>Another useful tool in the Vagrant user&rsquo;s arsenal is <a href="https://github.com/jedi4ever/veewee">Veewee</a>. Veewee lets you automate the VirtualBox application to install a full operating system with just the packages you want and need. Veewee does have some built-in validation tools, such as <code>vagrant basebox validate BOXNAME</code>, which will run a set of Cucumber acceptance tests to ensure that the virtual machine should work properly when brought up with Vagrant, as well as with the <a href="http://www.opscode.com/chef/">Chef</a> and <a href="http://puppetlabs.com/">Puppet</a> configuration management tools.</p>

<!--more-->


<p>Nonetheless, sometimes you might want to quickly pop onto the VM that&rsquo;s just been built by veewee before issuing a <code>vagrant basebox export BOXNAME</code> to save it to a .box file suitable for distribution. To easily enable this, just add the following to your <code>~/.ssh/config</code> file.</p>

<div class="highlight"><pre><code class="text"># Veewee box.
Host veewee-machine
  HostName 127.0.0.1
  User vagrant
  Port 7222
  UserKnownHostsFile /dev/null
  StrictHostKeyChecking no
  PasswordAuthentication no
  IdentityFile /home/smerrill/.rvm/gems/ruby-1.9.2-p290/gems/vagrant-0.8.6/keys/vagrant
  IdentitiesOnly yes
</code></pre></div>


<p>You&rsquo;ll need to change the <code>IdentityFile</code> directive to point at wherever Vagrant is installed on your machine. With the entry in your SSH config file in place, you can simply execute an <code>ssh veewee-machine</code> and kick the tires before bundling up the box.</p>

<p>Now go forth and build an army of virtual machines!</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Coat Your Website In Varnish, by Steve Merrill]]></title>
    <link href="http://smerrill.github.io/blog/2011/10/23/coat-your-website-in-varnish-by-steve-merrill/"/>
    <updated>2011-10-23T00:00:00-04:00</updated>
    <id>http://smerrill.github.io/blog/2011/10/23/coat-your-website-in-varnish-by-steve-merrill</id>
    <content type="html"><![CDATA[<p>The full presentation is embedded below.</p>


<p></p></p>

<!--more-->




<div class="prezi-player">
<style type="text/css" media="screen">.prezi-player { width: 550px; } .prezi-player-links { text-align: center; }</style><object id="prezi_rz6xsgdf1tx1" name="prezi_rz6xsgdf1tx1" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="550" height="400"><param name="movie" value="http://prezi.com/bin/preziloader.swf" /><param name="allowfullscreen" value="true" /><param name="allowscriptaccess" value="always" /><param name="bgcolor" value="#ffffff" /><param name="flashvars" value="prezi_id=rz6xsgdf1tx1&lock_to_path=0&color=ffffff&autoplay=no&autohide_ctrls=0" /><embed id="preziEmbed_rz6xsgdf1tx1" name="preziEmbed_rz6xsgdf1tx1" src="http://prezi.com/bin/preziloader.swf" type="application/x-shockwave-flash" allowfullscreen="true" allowscriptaccess="always" width="550" height="400" bgcolor="#ffffff" flashvars="prezi_id=rz6xsgdf1tx1&lock_to_path=0&color=ffffff&autoplay=no&autohide_ctrls=0"></embed></object>
<div class="prezi-player-links">
<p><a title="Information on using the Varnish reverse proxy cache to speed up your website!" href="http://prezi.com/rz6xsgdf1tx1/coat-your-website-in-varnish-badcamp-2011/">Coat Your Website in Varnish BADCamp 2011</a> on <a href="http://prezi.com">Prezi</a></p><br />
</div><br />
</div>


<p></p></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Dude, Where's My Bot?]]></title>
    <link href="http://smerrill.github.io/blog/2011/10/05/dude-wheres-my-bot/"/>
    <updated>2011-10-05T00:00:00-04:00</updated>
    <id>http://smerrill.github.io/blog/2011/10/05/dude-wheres-my-bot</id>
    <content type="html"><![CDATA[<p>Say what you will about node.js, but it is certainly an easy way to build IRC bots with the <a href="https://github.com/gf3/Jerk">Jerk library</a>.</p>

<p>The PHP-based bot that runs in the <a href="http://www.treehouseagency.com">Treehouse Agency</a> IRC channels knows to respond to &ldquo;Sweet!&rdquo; with &ldquo;Dude!&rdquo; and vice versa. <a href="http://www.brianmcmurray.com">Brian McMurray</a> said that he&rsquo;d like to someday write a quick-and-dirty bot that would put our other bot into an infinite loop.</p>

<p>I accepted that challenge, and 10 minutes later, the bot was done.</p>

<p>The code is an example of how to build a bot that accepts environmental variables for configuration and otherwise does a pretty silly task.</p>

<!--more-->


<p>All in all, node makes this <em>really</em> simple.</p>

<div class="highlight"><pre><code class="javascript"><span class="kd">var</span> <span class="nx">jerk</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;jerk&#39;</span><span class="p">),</span>
    <span class="nx">channel</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;SWEETDUDEBOT_CHANNEL&#39;</span> <span class="k">in</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">)</span><span class="o">?</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">SWEETDUDEBOT_CHANNEL</span> <span class="o">:</span> <span class="s1">&#39;#yourchannel&#39;</span><span class="p">,</span>
    <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">server</span><span class="o">:</span> <span class="p">(</span><span class="s1">&#39;SWEETDUDEBOT_SERVER&#39;</span> <span class="k">in</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">)</span><span class="o">?</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">SWEETDUDEBOT_SERVER</span> <span class="o">:</span> <span class="s1">&#39;chat.freenode.net&#39;</span><span class="p">,</span>
      <span class="nx">nick</span><span class="o">:</span> <span class="p">(</span><span class="s1">&#39;SWEETDUDEBOT_NICK&#39;</span> <span class="k">in</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">)</span><span class="o">?</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">SWEETDUDEBOT_NICK</span> <span class="o">:</span> <span class="s1">&#39;sweetdudebot&#39;</span><span class="p">,</span>
      <span class="nx">port</span><span class="o">:</span> <span class="p">(</span><span class="s1">&#39;SWEETDUDEBOT_PORT&#39;</span> <span class="k">in</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">)</span><span class="o">?</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">SWEETDUDEBOT_PORT</span> <span class="o">:</span> <span class="s1">&#39;6667&#39;</span><span class="p">,</span>
      <span class="nx">flood_protection</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
      <span class="nx">channels</span><span class="o">:</span> <span class="p">[</span><span class="nx">channel</span><span class="p">]</span>
    <span class="p">};</span>

<span class="kd">var</span> <span class="nx">sweet_dude_bot</span> <span class="o">=</span> <span class="nx">jerk</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">j</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">j</span><span class="p">.</span><span class="nx">watch_for</span><span class="p">(</span> <span class="sr">/^(Sweet|Dude)!$/</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">message</span><span class="p">.</span><span class="nx">match_data</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">result</span><span class="p">)</span>
      <span class="k">return</span><span class="p">;</span>

    <span class="k">switch</span> <span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">case</span> <span class="s2">&quot;Sweet&quot;</span><span class="o">:</span>
        <span class="nx">message</span><span class="p">.</span><span class="nx">say</span><span class="p">(</span><span class="s2">&quot;Dude!&quot;</span><span class="p">);</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="k">case</span> <span class="s2">&quot;Dude&quot;</span><span class="o">:</span>
        <span class="nx">message</span><span class="p">.</span><span class="nx">say</span><span class="p">(</span><span class="s2">&quot;Sweet!&quot;</span><span class="p">);</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">})</span>
<span class="p">}).</span><span class="nx">connect</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span>
</code></pre></div>


<p>You can fork <a href="https://github.com/smerrill/node-sweetdudebot">node-sweetdudebot</a> or its predecessor, <a href="https://github.com/smerrill/node-sedbot">node-sedbot</a> on GitHub. Enjoy!</p>
]]></content>
  </entry>
  
</feed>
