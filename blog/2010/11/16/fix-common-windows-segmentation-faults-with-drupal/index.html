<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Fix Common Windows Segmentation Faults with Drupal - Grenade Sandwich</title>
  <meta name="author" content="Steven W. Merrill">

  
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://smerrill.github.io/blog/2010/11/16/fix-common-windows-segmentation-faults-with-drupal">
  <link href="/favicon.png" type="image/png" rel="icon">
  <link href="/atom.xml" rel="alternate" title="Grenade Sandwich" type="application/atom+xml">

  <!-- Fira stylesheet -->
<link href="/assets/fonts/stylesheet.css" rel="stylesheet" type="text/css">
<link href="//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css" rel="stylesheet" type="text/css">
<!-- <link href="/javascripts/libs/bootstrap-3.0.0/dist/css/bootstrap-theme.min.css" rel="stylesheet" type="text/css"> -->
<link href="//netdna.bootstrapcdn.com/bootswatch/3.0.0/readable/bootstrap.min.css" rel="stylesheet" type="text/css">
<!--<link href="//netdna.bootstrapcdn.com/bootswatch/3.0.0/journal/bootstrap.min.css" rel="stylesheet" type="text/css">-->
<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
<!-- Awesome font. -->
<link href="//netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.min.css" rel="stylesheet" type="text/css">


  <script src="/javascripts/libs/jquery/jquery-2.0.3.min.js"></script>
  

</head>

  <body   >
    <div id="wrap">
      <header role="banner">
        <nav class="navbar navbar-default" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <strong>
              <a class="navbar-brand" href="/">Grenade Sandwich</a>
            </strong>
        </div>

        <div class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
                <li class="active">
                    <a href="/">Blog</a>
                </li>
                <li >
                    <a href="/blog/archives">Archives</a>
                </li>
                <li >
                    <a href="/about-site/">About this Site</a>
                </li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a class="subscribe-rss" href="/atom.xml" title="subscribe via RSS">
                        <span class="visible-xs">RSS</span>
                        <img class="hidden-xs" src="/images/rss.png" alt="RSS">
                    </a>
                </li>
                
            </ul>
            
                <form class="search navbar-form navbar-right visible-xs visible-md visible-lg" action="http://google.com/search" method="GET">
                    <input type="hidden" name="q" value="site:smerrill.github.io">
                    <div class="form-group">
                        <input class="form-control" type="text" name="q" placeholder="Search">
                    </div>
                </form>
            
        </div>
    </div>
</nav>


      </header>
      <div id="main" class="container">
        <div id="content">
          <div class="row">
  <div class="page-content col-md-9">
    <article class="hentry" role="article">
      
  <header class="page-header">
    
      <p class="meta text-muted text-uppercase">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2010-11-16T00:00:00-05:00" pubdate data-updated="true">Nov 16<span>th</span>, 2010</time>
        
      </p>
    
    
    <h1 class="entry-title">
        Fix Common Windows Segmentation Faults With Drupal
        
    </h1>
    
  </header>


<div class="entry-content clearfix">
  <p><em><a href="http://www.phase2technology.com/fix-common-windows-segmentation-faults-with-drupal/">This content was initially published</a> on the <a href="http://www.phase2technology.com/blog-list/">Phase2 blog</a>.</em></p>
</div>



<div class="entry-content clearfix"><p>At Treehouse Agency, we often work with internal development teams, and enterprise software being what it is, they often run Windows. This has been the primary driver behind some of our technology choices (using Mercurial rather than Git on these sorts of projects) and it also occasionally necessitates some extra debugging when something doesn&#8217;t quite work right on Windows.</p>


<p></p></p>

<p>In work on a recent project, the client developers were using WampServer, but upon the site reaching a certain size, developers on Windows noted that their Apache processes were quitting after a cache clear. We debugged and tracked the errors down to occuring during CSS preprocessing.  The Apache processes were segmentation faulting, resulting in an error dialog.</p>


<p></p></p>

<p>In an initial assessment of the problem, it appeared that others were having the same problem, such as in <a href="http://drupal.org/node/424136" title="http://drupal.org/node/424136">http://drupal.org/node/424136</a>. We advised the developers to add a line to their settings.php to disable css preprocessing, like so:</p>


<p></p></p>

<!--more-->




<p>
<div class="geshifilter">
<div class="php geshifilter-php"><span class="re0">$conf</span> <span class="sy0">=</span> <a href="http://www.php.net/array"><span class="kw3">array</span></a><span class="br0">(</span><br /><br />
  <span class="st_h">&#8216;preprocess_css&#8217;</span> <span class="sy0">=></span> <span class="kw4">FALSE</span><span class="sy0">,</span><br /><br />
<span class="br0">)</span><span class="sy0">;</span></div></div></p>


<p></p></p>

<p>This worked fine for awhile, but then the same problem came back in a different situation. Developers on Windows began to see the same segmentation faults on the main Features administration page or when reverting all Features. This led me to the real cause of these segmentation faults - stack overflows.  Both CSS preprocessing and Features reversion result in a number of recursive calls that will overflow a small stack, and therein lies a solution.</p>


<p></p></p>

<p>By default, Mac OS X allocates 8 megabytes of stack space for processes, while Windows allocates a much smaller amount (which looks to be closer to 1 megabyte.)  By changing the Apache configuration to allocate the same 8 megabytes of stack space per Apache thread, developers on Windows no longer experienced segmentation faults when optimizing CSS files or when reverting Features.</p>


<p></p></p>

<p>In order to set the stack size back up to 8 megabytes, you need to set the <code>ThreadStackSize</code> parameter in your Apache configuration files to <code>8388608</code>.  (The value is expressed in bytes.)</p>


<p></p></p>

<p>If this issue is affecting you on Windows, here are the two changes that you will need to make to your Windows configuration under WampServer.</p>


<p></p></p>

<p>In your main apache configuration file, uncomment the line that includes the httpd-mpm.conf file, like so:</p>


<p></p></p>

<p>
<div class="geshifilter">
<div class="php geshifilter-php"><span class="co2"># Server-pool management (MPM specific)<br /><br />
</span><span class="kw1">Include</span> conf<span class="sy0">/</span>extra<span class="sy0">/</span>httpd<span class="sy0">-</span>mpm<span class="sy0">.</span>conf</div></div></p>


<p></p></p>

<p>And then in the httpd-mpm.conf file, add a line to set the stack size up to 8 MB (as it is on Mac and Linux Apache by default.) Specifically, add the third line in:</p>


<p></p></p>

<p>
<div class="geshifilter">
<div class="php geshifilter-php"><span class="sy0"><</span>IfModule mpm_winnt_module<span class="sy0">></span><br /><br />
    ThreadsPerChild      <span class="nu0">150</span><br /><br />
    MaxRequestsPerChild    <span class="nu0">0</span><br /><br />
    ThreadStackSize  <span class="nu0">8388608</span><br /><br />
<span class="sy0"></</span>IfModule<span class="sy0">></span></div></div></p>


<p></p></p>

<p>Once Apache is restarted, you should be free of segmentation faults (or at least you shouldn&#8217;t run into problems until your colleagues on Linux and Mac OS do.)</p>


<p></p></p>
</div>


      <footer>
        <p class="meta text-muted">
          
  

<span class="glyphicon glyphicon-user"></span> <span class="byline author vcard">Posted by <span class="fn">Steven Merrill</span></span>

          












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2010-11-16T00:00:00-05:00" pubdate data-updated="true">Nov 16<span>th</span>, 2010</time>
          

<span class="glyphicon glyphicon-tags"></span>&nbsp;
<span class="categories">
  
    <a class='category' href='/blog/categories/phase2blog/'>phase2blog</a>, <a class='category' href='/blog/categories/segmentation-fault/'>segmentation fault</a>, <a class='category' href='/blog/categories/wamp/'>wamp</a>, <a class='category' href='/blog/categories/windows/'>windows</a>
  
</span>


        </p>
        
          <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://smerrill.github.io/blog/2010/11/16/fix-common-windows-segmentation-faults-with-drupal/" data-via="stevenmerrill" data-counturl="http://smerrill.github.io/blog/2010/11/16/fix-common-windows-segmentation-faults-with-drupal/" >Tweet</a>
  
  
  
</div>

        
        
          <ul class="meta text-muted pager">
            
            <li class="previous"><a href="/blog/2010/07/08/color-me-flexible-new-options-for-colorable-d7-themes/" title="Previous Post: Color Me Flexible: New options for colorable D7 themes">&laquo; Color Me Flexible: New options for colorable D7 themes</a></li>
            
            
            <li class="next"><a href="/blog/2011/06/22/be-more-awesome-please-tale-of-two-browsers/" title="Next Post: Be More Awesome (Please!) : A Tale of Two Browsers">Be More Awesome (Please!) : A Tale of Two Browsers &raquo;</a></li>
            
          </ul>
        
      </footer>
    </article>
    
  </div>

  
  <aside class="sidebar col-md-3">
    
      <section class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title">Recent Posts</h3>
  </div>
  
  <div id="recent_posts" class="list-group">
    
    <a class="list-group-item " href="/blog/2014/05/26/combining-tasks-with-grunt/">Combining Tasks With Grunt</a>
    
    <a class="list-group-item " href="/blog/2013/06/03/avoiding-flat-tires/">Avoiding Flat Tires in Your Web Application</a>
    
    <a class="list-group-item " href="/blog/2013/02/04/testing-drupal-with-ghosts-and-gherkins-at-drupalcampnj/">Testing Drupal With Ghosts and Gherkins at DrupalCampNJ</a>
    
    <a class="list-group-item " href="/blog/2012/09/23/omnios-vagrant/">OmniOS and Vagrant</a>
    
    <a class="list-group-item " href="/blog/2012/05/31/access-php-mysql-jquery-and-drupal-documentation-offline-on-your-mac-with-dash/">Access PHP, MySQL, jQuery, and Drupal Documentation Offline on Your Mac With Dash</a>
    
  </div>
</section>
<section class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title">Popular Categories</h3>
  </div>
  <div class="list-group">
    
    
    
    
    
    
    <a class="list-group-item " href="/blog/categories/conference/index.html">
      <span class="badge">2</span>
      conference
    </a>
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    <a class="list-group-item " href="/blog/categories/theming/index.html">
      <span class="badge">2</span>
      theming
    </a>
    
    
    
    
    
    
    
    
    
    
    
    
    <a class="list-group-item " href="/blog/categories/drupal/index.html">
      <span class="badge">16</span>
      drupal
    </a>
    
    
    
    
    
    
    
    
    
    
    
    
    <a class="list-group-item " href="/blog/categories/planet-drupal/index.html">
      <span class="badge">4</span>
      planet drupal
    </a>
    
    
    
    
    
    
    
    
    <a class="list-group-item " href="/blog/categories/development/index.html">
      <span class="badge">9</span>
      development
    </a>
    
    
    
    
    
    
    
    
    <a class="list-group-item " href="/blog/categories/performance/index.html">
      <span class="badge">6</span>
      performance
    </a>
    
    
    
    
    
    
    
    
    
    
    
    
    <a class="list-group-item " href="/blog/categories/views/index.html">
      <span class="badge">2</span>
      views
    </a>
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    <a class="list-group-item " href="/blog/categories/treehouse-agency/index.html">
      <span class="badge">3</span>
      treehouse agency
    </a>
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    <a class="list-group-item " href="/blog/categories/presentations/index.html">
      <span class="badge">8</span>
      presentations
    </a>
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    <a class="list-group-item " href="/blog/categories/web-development/index.html">
      <span class="badge">2</span>
      web development
    </a>
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    <a class="list-group-item " href="/blog/categories/cdn/index.html">
      <span class="badge">2</span>
      cdn
    </a>
    
    
    
    
    
    
    
    
    <a class="list-group-item " href="/blog/categories/centos/index.html">
      <span class="badge">2</span>
      centos
    </a>
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    <a class="list-group-item " href="/blog/categories/scala/index.html">
      <span class="badge">3</span>
      scala
    </a>
    
    
    
    
    
    
    
    
    <a class="list-group-item " href="/blog/categories/scala-2.7/index.html">
      <span class="badge">3</span>
      scala 2.7
    </a>
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    <a class="list-group-item " href="/blog/categories/browsers/index.html">
      <span class="badge">2</span>
      browsers
    </a>
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    <a class="list-group-item " href="/blog/categories/caching/index.html">
      <span class="badge">2</span>
      caching
    </a>
    
    
    
    
    
    
    
    
    <a class="list-group-item " href="/blog/categories/scalability/index.html">
      <span class="badge">2</span>
      scalability
    </a>
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    <a class="list-group-item " href="/blog/categories/vagrant/index.html">
      <span class="badge">5</span>
      vagrant
    </a>
    
    
    
    
    
    
    
    
    <a class="list-group-item " href="/blog/categories/virtualbox/index.html">
      <span class="badge">2</span>
      virtualbox
    </a>
    
    
    
    
    
    
    
    
    
    
    
    
    <a class="list-group-item " href="/blog/categories/irc/index.html">
      <span class="badge">2</span>
      irc
    </a>
    
    
    
    
    
    
    
    
    
    
    
    
    <a class="list-group-item " href="/blog/categories/veewee/index.html">
      <span class="badge">2</span>
      veewee
    </a>
    
    
    
    
    
    
    
    
    
    
    
    
    <a class="list-group-item " href="/blog/categories/drupal-planet/index.html">
      <span class="badge">3</span>
      drupal planet
    </a>
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    <a class="list-group-item " href="/blog/categories/virtualization/index.html">
      <span class="badge">3</span>
      virtualization
    </a>
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    <a class="list-group-item " href="/blog/categories/php/index.html">
      <span class="badge">2</span>
      php
    </a>
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
  </div>
</section>

<section class="panel panel-default clearfix">
  <div class="panel-heading">
      <h3 class="panel-title">GitHub Repos</h3>
  </div>
  <div class="list-group" id="gh_repos">
    <p class="loading">Status updating...</p>
  </div>
  
    <div class="gh-profile-link pull-right text-muted">
      <a href="https://github.com/smerrill">@smerrill</a> on GitHub
    </div>
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'smerrill',
            count: 5,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


    
  </aside>
  
</div>

        </div>
      </div>
    </div>
    <footer role="contentinfo"><div class="container">
    <p class="text-muted credits">
  Copyright &copy; 2009 - 2014 by Steven W. Merrill<br>
  <small>
      <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>,
      <span class="credit">customized with <a href="https://github.com/kAworu/octostrap3">octostrap3</a></span>.
  </small>
</p>

</div>
</footer>
    <script src="/javascripts/libs/bootstrap-3.0.0/dist/js/bootstrap.min.js"></script>
<script src="/javascripts/modernizr-2.0.js"></script>








  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





  </body>
</html>
